# üìä Gu√≠a Completa: Exportaci√≥n Autom√°tica a Google Sheets desde N8n Cloud

## üéØ Objetivo

Configurar un workflow en N8n Cloud que reciba grants filtrados desde la UI (sin √°nimo de lucro + presupuesto ‚â•500k‚Ç¨) y los exporte autom√°ticamente a Google Sheets para el equipo de proyectos.

**Beneficio**: Ahorra horas de b√∫squeda manual en Fandit, centralizando la informaci√≥n en un Excel accesible.

---

## üìã Tabla de Contenidos

1. [Preparaci√≥n: Google Sheets](#1-preparaci√≥n-google-sheets)
2. [Configuraci√≥n: N8n Cloud](#2-configuraci√≥n-n8n-cloud)
3. [Importaci√≥n del Workflow](#3-importaci√≥n-del-workflow)
4. [Configuraci√≥n de Nodos](#4-configuraci√≥n-de-nodos)
5. [Conexi√≥n con Backend](#5-conexi√≥n-con-backend)
6. [Prueba del Flujo](#6-prueba-del-flujo)
7. [Troubleshooting](#7-troubleshooting)

---

## 1. Preparaci√≥n: Google Sheets

### 1.1 Crear Google Sheet

1. Ve a [Google Sheets](https://sheets.google.com)
2. Crea una nueva hoja llamada: **"Subvenciones Sin √Ånimo Lucro"**
3. En la primera fila (Row 1), a√±ade estos headers:

| A | B | C | D | E | F | G | H | I | J | K |
|---|---|---|---|---|---|---|---|---|---|---|
| Fuente | C√≥digo | Subvencionador | T√≠tulo | Fecha Publicaci√≥n | Fecha Fin Original | Fecha Fin Calculada | Montante Econ√≥mico | Link Principal | Link PDF | Sede Electr√≥nica |

### 1.2 Formatear Columnas

- **Columna E, F, G** (Fechas): Formato ‚Üí N√∫mero ‚Üí Fecha (`DD/MM/YYYY`)
- **Columna H** (Montante): Formato ‚Üí N√∫mero ‚Üí Moneda (`‚Ç¨`)
- **Columna I, J, K** (Links): Dejar como texto (N8n insertar√° URLs clickables)

### 1.3 Obtener ID del Sheet

La URL del Google Sheet es:
```
https://docs.google.com/spreadsheets/d/XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX/edit
```

Copia el ID (la parte `XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX`). Lo necesitar√°s en N8n.

---

## 2. Configuraci√≥n: N8n Cloud

### 2.1 Acceder a N8n Cloud

1. Ve a [N8n Cloud](https://n8n.cloud)
2. Inicia sesi√≥n con tu cuenta
3. Ve a **Workflows** ‚Üí **New Workflow**

### 2.2 Configurar Credenciales de Google Sheets

1. En N8n, ve a **Credentials** (men√∫ lateral)
2. Click en **Add Credential**
3. Busca **"Google Sheets OAuth2 API"**
4. Click en **Connect my account**
5. Autoriza con tu cuenta de Google (la que tiene acceso al Sheet)
6. Guarda las credenciales con nombre: `Google Sheets - Subvenciones`

**Nota**: N8n Cloud maneja OAuth2 autom√°ticamente, no necesitas crear credenciales manualmente.

---

## 3. Importaci√≥n del Workflow

### 3.1 Descargar JSON del Workflow

El archivo `n8n_workflow_google_sheets.json` est√° en la ra√≠z del proyecto.

### 3.2 Importar en N8n Cloud

1. En N8n Cloud, abre un workflow nuevo
2. Click en el men√∫ **‚ãÆ** (tres puntos) arriba a la derecha
3. Selecciona **Import from File**
4. Sube el archivo `n8n_workflow_google_sheets.json`
5. El workflow se importar√° con 5 nodos:
   - Webhook
   - Calculate Dates
   - Map to Sheet Columns
   - Google Sheets
   - Respond to Webhook

---

## 4. Configuraci√≥n de Nodos

### 4.1 Nodo 1: Webhook

**Prop√≥sito**: Recibir el payload desde el backend.

1. Click en el nodo **Webhook**
2. Configuraci√≥n:
   - **HTTP Method**: `POST`
   - **Path**: `boe-grants-to-sheets` (o el que prefieras)
   - **Authentication**: None (puedes a√±adir header auth si quieres)
3. Copia la **Production URL** que aparece. Ejemplo:
   ```
   https://yourinstance.app.n8n.cloud/webhook/boe-grants-to-sheets
   ```
4. **Guarda esta URL** - la necesitar√°s para el backend

### 4.2 Nodo 2: Calculate Dates (Function)

**Prop√≥sito**: Calcular fechas relativas como "20 d√≠as h√°biles" a fechas exactas.

Este nodo ya tiene el c√≥digo JavaScript necesario. Revisa que:
- Detecta patrones: "X d√≠as h√°biles", "X d√≠as naturales"
- Calcula fechas saltando fines de semana
- Maneja fechas ISO ya calculadas

**No necesitas cambiar nada aqu√≠**, pero puedes revisar el c√≥digo si quieres ajustar la l√≥gica.

### 4.3 Nodo 3: Map to Sheet Columns (Set)

**Prop√≥sito**: Mapear campos del payload a columnas del Google Sheet.

Este nodo ya tiene el mapeo completo:
- `source` ‚Üí Fuente
- `bdns_code` o `boe_id` ‚Üí C√≥digo
- `department` ‚Üí Subvencionador
- etc.

**No necesitas cambiar nada**, pero verifica que los nombres de campos coincidan con tu modelo Grant.

### 4.4 Nodo 4: Google Sheets

**Prop√≥sito**: Insertar la fila en Google Sheets.

1. Click en el nodo **Google Sheets**
2. Configuraci√≥n:
   - **Credential**: Selecciona `Google Sheets - Subvenciones` (la que creaste)
   - **Operation**: `Append`
   - **Document**: Pega el **ID del Sheet** que copiaste en el paso 1.3
   - **Sheet**: `Sheet1` (o el nombre de tu hoja, por defecto es Sheet1)
   - **Options**:
     - ‚úÖ **Use header row** (Row 1 tiene los headers)

### 4.5 Nodo 5: HTTP Request (Callback) - **CR√çTICO**

**Prop√≥sito**: Notificar al backend que el grant se export√≥ exitosamente a Google Sheets.

‚ö†Ô∏è **IMPORTANTE**: Este nodo es DIFERENTE de "Respond to Webhook". Es una llamada HTTP ADICIONAL.

1. **A√±adir nuevo nodo HTTP Request** DESPU√âS del nodo Google Sheets
2. Configuraci√≥n:
   - **Method**: `POST`
   - **URL**: `http://localhost:8000/api/v1/webhook/callback/sheets`
     - En producci√≥n: Usar URL p√∫blica del backend
   - **Authentication**: None (o a√±adir header auth si necesario)
   - **Body** (JSON):
     ```json
     {
       "grant_id": "{{ $json.C√≥digo }}",
       "status": "success",
       "sheets_url": "https://docs.google.com/spreadsheets/d/YOUR_SPREADSHEET_ID",
       "row_id": null,
       "error_message": null
     }
     ```

**¬øPor qu√© es necesario este nodo?**
- "Respond to Webhook" solo responde a la petici√≥n HTTP ORIGINAL (Backend ‚Üí N8n)
- Este callback hace una NUEVA petici√≥n HTTP (N8n ‚Üí Backend) para actualizar el estado del grant
- Sin este callback, la UI nunca mostrar√° el icono verde de "exportado"

### 4.6 Nodo 6: Respond to Webhook

**Prop√≥sito**: Responder al webhook original del backend.

Este nodo ya est√° configurado para devolver:
```json
{
  "success": true,
  "message": "Grant exported to Google Sheets",
  "grant_id": "{{ $json.id }}"
}
```

**Orden correcto de nodos**:
```
1. Webhook (recibe grant)
   ‚Üì
2. Calculate Dates
   ‚Üì
3. Map to Sheet Columns
   ‚Üì
4. Google Sheets - Append Row
   ‚Üì
5. HTTP Request (CALLBACK - actualiza backend) ‚Üê NUEVO
   ‚Üì
6. Respond to Webhook (cierra conexi√≥n original)
```

---

## 5. Conexi√≥n con Backend

### 5.1 Actualizar N8n Webhook URL en .env

En el archivo `.env` del backend:

```env
N8N_WEBHOOK_URL=https://yourinstance.app.n8n.cloud/webhook/boe-grants-to-sheets
```

Reemplaza con la URL real de tu webhook de N8n Cloud.

### 5.2 Verificar Endpoint de Env√≠o

El backend ya tiene el endpoint `/api/v1/webhook/send` que env√≠a grants a N8n.

Cuando el usuario hace clic en "Enviar a N8n" en la UI, el backend:
1. Recibe el `grant_id`
2. Obtiene el grant completo de la base de datos
3. Llama a `grant.to_n8n_payload()` para generar el payload
4. Env√≠a POST a `N8N_WEBHOOK_URL` con el payload
5. Marca el grant como `sent_to_n8n=True`

**No necesitas cambiar c√≥digo**, solo actualizar la URL del webhook.

---

## 6. Prueba del Flujo

### 6.1 Activar el Workflow en N8n

1. En N8n Cloud, en tu workflow
2. Click en el toggle **Inactive** ‚Üí **Active** (arriba a la derecha)
3. El workflow ahora est√° escuchando webhooks

### 6.2 Probar desde la UI

1. Abre la UI del frontend: `http://localhost:5173`
2. Ve a la p√°gina de **Grants**
3. Filtra por:
   - ‚úÖ **Sin √°nimo de lucro**
   - **Presupuesto m√≠nimo**: 500000
4. Selecciona un grant de la lista
5. Click en **"Enviar a N8n"** (o el bot√≥n equivalente)
6. Verifica en la consola del navegador que la petici√≥n fue exitosa

### 6.3 Verificar en Google Sheets

1. Abre tu Google Sheet
2. Deber√≠as ver una nueva fila con los datos del grant:
   - Fuente (BDNS o BOE)
   - C√≥digo
   - T√≠tulo
   - Fechas
   - Montante
   - Links clickables

### 6.4 Verificar en N8n Cloud

1. En N8n Cloud, ve a **Executions** (men√∫ lateral)
2. Verifica que hay una ejecuci√≥n reciente con estado **Success** ‚úÖ
3. Click en la ejecuci√≥n para ver el detalle:
   - Webhook recibi√≥ el payload
   - Calculate Dates proces√≥ las fechas
   - Google Sheets insert√≥ la fila

---

## 7. Troubleshooting

### ‚ùå Error: "Authentication failed"

**Soluci√≥n**:
1. Ve a Credentials en N8n
2. Reautoriza la cuenta de Google
3. Verifica que la cuenta tiene acceso al Google Sheet

### ‚ùå Error: "Sheet not found"

**Soluci√≥n**:
1. Verifica que el **ID del Sheet** es correcto
2. Verifica que el nombre de la hoja es correcto (por defecto `Sheet1`)
3. Aseg√∫rate de que la cuenta de Google de N8n tiene permisos de edici√≥n

### ‚ùå Error: "Webhook not responding"

**Soluci√≥n**:
1. Verifica que el workflow est√° **Active** en N8n
2. Verifica que la URL del webhook en `.env` es correcta
3. Prueba el webhook manualmente con `curl`:
```bash
curl -X POST https://yourinstance.app.n8n.cloud/webhook/boe-grants-to-sheets \
  -H "Content-Type: application/json" \
  -d '{
    "id": "TEST-123",
    "source": "BDNS",
    "title": "Test Grant",
    "department": "Test Dept",
    "budget_amount": 600000
  }'
```

### ‚ùå Fechas no se calculan correctamente

**Soluci√≥n**:
1. Revisa el nodo **Calculate Dates**
2. Verifica que el patr√≥n regex detecta correctamente el texto:
   - "20 d√≠as h√°biles desde publicaci√≥n"
   - "15 d√≠as naturales"
3. Ajusta la l√≥gica de c√°lculo si es necesario

### ‚ùå Duplicados en el Sheet

**Soluci√≥n**:
El flujo actual hace **append** (a√±adir siempre). Si quieres evitar duplicados:
1. A√±ade un nodo **Google Sheets** antes del insert para buscar el c√≥digo
2. Usa un nodo **If** para verificar si existe
3. Solo inserta si no existe

**Nota**: Esto ralentiza el proceso. Para urgencia, mejor append siempre y limpiar duplicados manualmente despu√©s.

---

## üìä Estructura del Payload

El backend env√≠a este payload a N8n:

```json
{
  "id": "BDNS-863212",
  "source": "BDNS",
  "type": "grant",
  "timestamp": "2025-10-18T01:00:00",

  "title": "Subvenciones para proyectos sociales",
  "description": "Convocatoria publicada por Ministerio X",
  "department": "Ministerio de Derechos Sociales",
  "section": "III. Otras disposiciones",

  "pdf_url": "https://www.infosubvenciones.es/.../pdf",
  "html_url": "https://boe.es/diario_boe/txt.php?id=BOE-A-2024-12345",
  "xml_url": "https://boe.es/diario_boe/xml.php?id=BOE-A-2024-12345",

  "pdf_content_text": "CONVOCATORIA BDNS - T√≠tulo\n...",
  "pdf_content_markdown": "# T√≠tulo\n...",

  "metadata": {
    "bdns_code": "863212",
    "bdns_id": 863212,
    "budget_amount": 600000,
    "application_start_date": "2025-01-15",
    "application_end_date": "2025-03-15",
    "is_open": true,
    "is_nonprofit": true,
    "nonprofit_confidence": 0.9,
    "beneficiary_types": ["Fundaciones", "Asociaciones"],
    "sectors": ["Acci√≥n Social"],
    "regions": ["ES41 - CASTILLA Y LE√ìN"],
    "instruments": ["Subvenci√≥n"],
    "funds": ["MRR"],
    "convocatoria_type": "Concurrencia competitiva",
    "purpose": "Financiar proyectos sociales...",
    "regulatory_base_url": "https://...",
    "electronic_office": "https://sede.gob.es/...",
    "state_aid_number": "SA.12345",
    "state_aid_url": "https://..."
  },

  "processing_info": {
    "captured_at": "2025-10-18T01:00:00",
    "estimated_relevance": 0.85,
    "pdf_processed": true,
    "extraction_method": "bdns_api",
    "data_type": "structured",
    "enriched": true
  },

  "bdns_code": "863212",
  "publication_date": "2025-01-15",
  "application_end_date": "2025-03-15",
  "budget_amount": 600000,
  "is_nonprofit": true,
  "electronic_office": "https://sede.gob.es/..."
}
```

N8n extrae de este payload:
- `source` ‚Üí Fuente
- `metadata.bdns_code` o `id` ‚Üí C√≥digo
- `department` ‚Üí Subvencionador
- `title` ‚Üí T√≠tulo
- `publication_date` ‚Üí Fecha Publicaci√≥n
- `application_end_date` ‚Üí Fecha Fin (a calcular si es relativa)
- `budget_amount` ‚Üí Montante Econ√≥mico
- `metadata.regulatory_base_url` o `pdf_url` ‚Üí Link PDF
- `metadata.electronic_office` ‚Üí Sede Electr√≥nica

---

## üéâ ¬°Listo!

Ahora cada vez que el equipo de proyectos filtre grants en la UI y haga clic en "Enviar a N8n", los grants se exportar√°n autom√°ticamente a Google Sheets.

**Resultado**: Excel actualizado en tiempo real sin tocar Fandit.

---

## üìù Notas Adicionales

### Personalizaci√≥n del Sheet

Puedes a√±adir m√°s columnas en Google Sheets:
- **Estado**: Para marcar "Revisado", "En progreso", etc.
- **Responsable**: Asignar quien trabaja cada grant
- **Notas**: Comentarios del equipo

N8n solo escribe las 11 columnas base. Las adicionales las gestionan manualmente.

### Automatizaci√≥n de Actualizaciones

Si quieres que N8n actualice grants existentes (en lugar de append):
1. A√±ade un nodo **Google Sheets Lookup** para buscar por c√≥digo
2. Usa **If** para verificar si existe
3. Si existe: **Update Row**
4. Si no existe: **Append Row**

Esto es m√°s lento pero evita duplicados.

### Notificaciones

Puedes a√±adir un nodo **Send Email** al final para notificar al equipo cuando se exporta un grant nuevo.

---

**¬øPreguntas?** Revisa la secci√≥n de Troubleshooting o contacta al equipo t√©cnico.

---

## üìä Diagrama de Flujo Completo

### Flujo de Comunicaci√≥n HTTP

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  FLUJO COMPLETO CON CALLBACK                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. Usuario selecciona grant en UI
   ‚îÇ
   ‚îú‚îÄ‚îÄ> Frontend hace POST /api/v1/webhook/send
        ‚îÇ
        ‚îî‚îÄ‚îÄ> Backend obtiene grant de DB y env√≠a a N8n
             ‚îÇ
             ‚îú‚îÄ‚îÄ> HTTP POST a N8n webhook URL
                  ‚îÇ
                  ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ         N8n WORKFLOW               ‚îÇ
              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
              ‚îÇ 1. Webhook (recibe payload)        ‚îÇ
              ‚îÇ 2. Calculate Dates                 ‚îÇ
              ‚îÇ 3. Map to Sheet Columns            ‚îÇ
              ‚îÇ 4. Google Sheets - Append Row      ‚îÇ
              ‚îÇ                                    ‚îÇ
              ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
              ‚îÇ ‚îÇ  5. HTTP Request (CALLBACK)    ‚îÇ ‚îÇ
              ‚îÇ ‚îÇ  POST /callback/sheets         ‚îÇ ‚îÇ
              ‚îÇ ‚îÇ  ‚Üì                             ‚îÇ ‚îÇ
              ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
              ‚îÇ                ‚Üì                   ‚îÇ
              ‚îÇ    Backend actualiza:              ‚îÇ
              ‚îÇ    - google_sheets_exported=True   ‚îÇ
              ‚îÇ    - google_sheets_exported_at     ‚îÇ
              ‚îÇ    - google_sheets_url             ‚îÇ
              ‚îÇ                                    ‚îÇ
              ‚îÇ 6. Respond to Webhook (cierra)     ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
             Backend recibe respuesta {"success": true}
             ‚îÇ
             ‚îî‚îÄ‚îÄ> Frontend muestra "Enviado exitosamente"

2. Frontend refresca tabla de grants
   ‚îÇ
   ‚îî‚îÄ‚îÄ> GET /api/v1/grants
        ‚îÇ
        ‚îî‚îÄ‚îÄ> Backend retorna grants con google_sheets_exported=true
             ‚îÇ
             ‚îî‚îÄ‚îÄ> UI muestra icono verde Google Sheets con link
```

### Dos Comunicaciones HTTP Diferentes

**‚ö†Ô∏è CR√çTICO DE ENTENDER:**

1. **Comunicaci√≥n Original** (Backend ‚Üí N8n):
   - Backend env√≠a grant a N8n
   - N8n procesa y **responde** con "Respond to Webhook"
   - Esta es una comunicaci√≥n **s√≠ncrona** HTTP request/response

2. **Comunicaci√≥n Callback** (N8n ‚Üí Backend):
   - N8n hace una **nueva** petici√≥n HTTP al backend
   - Backend actualiza el estado del grant en la DB
   - Esta es una comunicaci√≥n **as√≠ncrona** independiente

```
Backend ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> N8n
         (1) POST grant to webhook

Backend <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ N8n
         (2) Respond to Webhook {"success": true}

Backend <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ N8n
         (3) Callback POST /callback/sheets
         (Actualiza google_sheets_exported)
```

### Qu√© Pasa Sin el Callback

Sin el nodo HTTP Request de callback:

```
‚ùå SIN CALLBACK:
   1. Grant se env√≠a a N8n ‚úÖ
   2. Grant se exporta a Google Sheets ‚úÖ
   3. Backend NO se entera de la exportaci√≥n ‚ùå
   4. UI sigue mostrando icono √°mbar "procesando" ‚ùå
   5. Usuario no sabe si se export√≥ exitosamente ‚ùå
```

Con el callback configurado:

```
‚úÖ CON CALLBACK:
   1. Grant se env√≠a a N8n ‚úÖ
   2. Grant se exporta a Google Sheets ‚úÖ
   3. N8n notifica al backend v√≠a callback ‚úÖ
   4. Backend actualiza google_sheets_exported=true ‚úÖ
   5. UI muestra icono verde con link a Sheets ‚úÖ
   6. Usuario puede hacer clic para ver el grant en Sheets ‚úÖ
```

---

**√öltima actualizaci√≥n**: 2025-10-20
**Cambios**: A√±adida secci√≥n cr√≠tica sobre callback HTTP Request
